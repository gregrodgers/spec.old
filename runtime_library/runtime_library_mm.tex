\section{Memory Management Routines}
\index{memory management routines}
\label{sec:Memory Management Routines}
This section describes routines that support management of memory on the current device.

Instances of OpenMP memory management types must be accessed only through the routines described in this section; programs that otherwise access OpenMP instances of these types are non-conforming.

\subsection{Memory Management Types}
\label{subsec:Memory Management Types}

The following type definitions are used by the memory management routines:

\ccppspecificstart
omp_allocator_t;
enum \{ OMP_NULL_ALLOCATOR = NULL \};
\end{codepar}
\ccppspecificend

\fortranspecificstart
\begin{codepar}
integer parameter omp_allocator_kind
integer(kind=omp_allocator_kind), &
        parameter :: omp_null_allocator = 0
\end{codepar}
\fortranspecificend

\subsection{\code{omp\_set\_default\_allocator}}
\index{omp\_set\_default\_allocator@{\code{omp\_set\_default\_allocator}}}
\label{subsec:omp_set_default_allocator}

\summary
The \code{omp\_set\_default\_allocator} routine sets the default allocator to be used by allocation calls, directives and clauses that use default allocation.

\format
\ccppspecificstart
\begin{boxedcode}
void omp_set_default_allocator (omp_allocator_t *\plc{allocator});
\end{boxedcode}
\ccppspecificend
\fortranspecificstart
\begin{boxedcode}
subroutine omp_set_default_allocator ( \plc{allocator} )
integer(kind=omp_allocator_kind),intent(in) allocator
\end{boxedcode}
\fortranspecificend
\binding
The binding task set for an \code{omp\_set\_default\_allocator} region is the generating task.

\constraints

The \plc{allocator} argument must be a predefined allocator.

\effect

The effect of this routine is to set the value of the \plc{def-allocator-var} ICV of the current task to the value specified in the \plc{allocator} argument. 

\crossreferences

\begin{itemize}
\item \plc{def-allocator-var} ICV, see \specref{sec:Internal Control Variables}.
\item Memory Allocators, see \specref{sec:Memory Allocators}.
\item \code{omp\_alloc} routine, see \specref{subsec:omp_alloc}.
\end{itemize}

\subsection{\code{omp\_get\_default\_allocator}}
\index{omp\_get\_default\_allocator@{\code{omp\_get\_default\_allocator}}}
\label{subsec:omp_get_default_allocator}

\summary
The \code{omp\_get\_default\_allocator} routine returns the allocator to be used by allocation calls, directives and clauses that use default allocation.

\format
\ccppspecificstart
\begin{boxedcode}
omp_allocator_t * omp_get_default_allocator (void);
\end{boxedcode}
\ccppspecificend
\fortranspecificstart
\begin{boxedcode}
integer(kind=omp_allocator_kind) 
function omp_get_default_allocator ()
\end{boxedcode}
\fortranspecificend

\binding

The binding task set for an \code{omp\_get\_default\_allocator} region is the generating task.

\effect

The effect of this routine is to return the value of the \plc{def-allocator-var} ICV of the current task.

\crossreferences
\begin{itemize}
\item \plc{def-allocator-var} ICV, see \specref{sec:Internal Control Variables}.
\item Memory Allocators, see \specref{sec:Memory Allocators}.
\item \code{omp\_alloc} routine, see \specref{subsec:omp_alloc}.
\end{itemize}

\ccppspecificstart

\subsection{\code{omp\_set\_target\_default\_allocator}}
\index{omp\_set\_target\_default\_allocator@{\code{omp\_set\_target\_default\_allocator}}}
\label{subsec:omp_set_target_default_allocator}

\summary
The \code{omp\_set\_target\_default\_allocator} routine sets the default allocator to be used on a target device by allocation calls, directives and clauses that use default allocation.

\format
\ccppspecificstart
\begin{boxedcode}
void omp_set_target_default_allocator (omp_allocator_t *\plc{allocator});
\end{boxedcode}
\ccppspecificend
\fortranspecificstart
\begin{boxedcode}
subroutine omp_set_target_default_allocator ( \plc{allocator} )
integer(kind=omp_allocator_kind),intent(in) allocator
\end{boxedcode}
\fortranspecificend
\binding
The binding task set for an \code{omp\_set\_target\_default\_allocator} region is the generating task.

\constraints

The \plc{allocator} argument must be a predefined allocator.

\effect

The effect of this routine is to set the value of the \plc{target-def-allocator-var} ICV of the current task to the value specified in the \plc{allocator} argument. 

\crossreferences

\begin{itemize}
\item \plc{target-def-allocator-var} ICV, see \specref{sec:Internal Control Variables}.
\item Memory Allocators, see \specref{sec:Memory Allocators}.
\item \code{omp\_alloc} routine, see \specref{subsec:omp_alloc}.
\end{itemize}

\subsection{\code{omp\_get\_target\_default\_allocator}}
\index{omp\_get\_target\_default\_allocator@{\code{omp\_get\_target\_default\_allocator}}}
\label{subsec:omp_get_target_default_allocator}

\summary
The \code{omp\_get\_target\_default\_allocator} routine returns the allocator to be used on a target device by allocation calls, directives and clauses that use default allocation.

\format
\ccppspecificstart
\begin{boxedcode}
omp_allocator_t * omp_get_target_default_allocator (void);
\end{boxedcode}
\ccppspecificend
\fortranspecificstart
\begin{boxedcode}
integer(kind=omp_allocator_kind) 
function omp_get_target_default_allocator ()
\end{boxedcode}
\fortranspecificend

\binding

The binding task set for an \code{omp\_get\_target\_default\_allocator} region is the generating task.

\effect

The effect of this routine is to return the value of the \plc{target-def-allocator-var} ICV of the current task.

\crossreferences
\begin{itemize}
\item \plc{target-def-allocator-var} ICV, see \specref{sec:Internal Control Variables}.
\item Memory Allocators, see \specref{sec:Memory Allocators}.
\item \code{omp\_alloc} routine, see \specref{subsec:omp_alloc}.
\end{itemize}

\ccppspecificstart


\subsection{\code{omp\_alloc}}
\index{omp\_alloc@{\code{omp\_alloc}}}
\label{subsec:omp_alloc}

\summary
The \code{omp\_alloc} requests a memory allocation to an \plc{allocator}.

\format
\begin{boxedcode}
void * omp_alloc (size_t \plc{size}, omp_allocator_t *\plc{allocator});  (C)
void * omp_alloc (size_t \plc{size}, 
           omp_allocator_t *\plc{allocator}=OMP_NULL_ALLOCATOR); (C++)
\end{boxedcode}

\effect

The \code{omp\_alloc} routine requests a memory allocation of \plc{size} bytes from the specified \plc{allocator} without specifying an allocation alignment. If value of the \plc{allocator} argument is 
\code{OMP\_NULL\_ALLOCATOR} the allocator used by the routine will be the one specified by the \plc{def-allocator-var} ICV.
Upon success it returns a pointer to the allocated memory. Otherwise, the behavior of the call depends on the \code{fallback} trait of the allocator.

\crossreferences
\begin{itemize}
\item How Allocations Works, see \specref{subsec:How Allocation Works}.
\end{itemize}

\subsection{\code{omp\_free}}
\index{omp\_free@{\code{omp\_free}}}
\label{subsec:omp_free}

\summary
The \code{omp\_free} routine deallocates previously allocated memory. 

\format

\begin{boxedcode}
void omp_free ( void * \plc{ptr}, omp\_allocator\_t *\plc{allocator});        (C)
void omp_free ( void * \plc{ptr}, 
             omp\_allocator\_t *\plc{allocator} = OMP_NULL_ALLOCATOR); (C++)
\end{boxedcode}

\effect

The \code{omp\_free} routine deallocates the memory pointed by \plc{ptr}. The \plc{ptr} argument must point to memory previously allocated with an OpenMP allocator. If the \plc{allocator} is specified it must be the allocator to which the allocation request was made. If the \plc{allocator} argument is \code{OMP\_NULL\_ALLOCATOR} the implementation will find the allocator used to allocate the memory. Using \code{omp\_free} on memory that was already deallocated results in unspecified behavior.

\ccppspecificend
