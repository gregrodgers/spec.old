% This is tool_support.tex (Chapter 4) of the OpenMP specification.
% This is an included file. See the master file for more information.
%
% When editing this file:
%
%    1. To change formatting, appearance, or style, please edit openmp.sty.
%
%    2. Custom commands and macros are defined in openmp.sty.
%
%    3. Be kind to other editors -- keep a consistent style by copying-and-pasting to
%       create new content.
%
%    4. We use semantic markup, e.g. (see openmp.sty for a full list):
%         \code{}     % for bold monospace keywords, code, operators, etc.
%         \plc{}      % for italic placeholder names, grammar, etc.
%
%    5. There are environments that provide special formatting, e.g. language bars.
%       Please use them whereever appropriate.  Examples are:
%
%         \begin{fortranspecific}
%         This is text that appears enclosed in blue language bars for Fortran.
%         \end{fortranspecific}
%
%         \begin{note}
%         This is a note.  The "Note -- " header appears automatically.
%         \end{note}
%
%    6. Other recommendations:
%         Use the convenience macros defined in openmp.sty for the minor headers
%         such as Comments, Syntax, etc.
%
%         To keep items together on the same page, prefer the use of
%         \begin{samepage}.... Avoid \parbox for text blocks as it interrupts line numbering.
%         When possible, avoid \filbreak, \pagebreak, \newpage, \clearpage unless that's
%         what you mean. Use \needspace{} cautiously for troublesome paragraphs.
%
%         Avoid absolute lengths and measures in this file; use relative units when possible.
%         Vertical space can be relative to \baselineskip or ex units. Horizontal space
%         can be relative to \linewidth or em units.
%
%         Prefer \emph{} to italicize terminology, e.g.:
%             This is a \emph{definition}, not a placeholder.
%             This is a \plc{var-name}.
%

\newcommand\longlongint{uint64\_t}
\newcommand\ulonglongint{uint64\_t}
\newcommand\callbackarg{argument}

\newcommand{\devicedesc}{
The \callbackarg{} \plc{device} is a pointer to an opaque object that
represents the target device instance. The pointer to the device
instance object is used by functions in the device tracing interface
to identify the device being addressed.
}

\newcommand{\epdesc}{
The \callbackarg{} \plc{endpoint} indicates whether the callback is
signalling the beginning or the end of a scope.
}

\newcommand\codeptrdesc{
The \callbackarg{} \plc{codeptr\_ra} is used to relate the implementation
of an OpenMP region back to its source code.  In cases where a runtime
routine implements the region associated with this callback,
\plc{codeptr\_ra} is expected to contain the return address of the
call to the runtime routine.  In cases where the implementation of
this feature is inlined, \plc{codeptr\_ra} is expected to contain the
return address of the invocation of this callback.  In cases where
attribution to source code is impossible or inappropriate,
\plc{codeptr\_ra} may be \code{NULL}.
}


\newcommand{\ompttype}[1]{\subsubsection{#1}}  % section 4.5.7
\newcommand{\ompttoolsignature}[1]{\subsection{#1}}  % section 4.8.2
\newcommand{\omptcallbacksignature}[1]{\subsubsection{#1}}  % section 4.8.2
\newcommand{\omptruntimeentrypoint}[1]{\subsubsection{#1}}  % sections 4.9.*
\newcommand{\ompteventswithoutdirectives}[1]{\littleheader{#1}}

\newcommand{\ompdsection}[1]{\section{#1}}  % section 4.9
\newcommand{\ompdsubsection}[1]{\subsection{#1}}  % section 4.9.1
\newcommand{\ompdcallbacksignature}[1]{\subsubsection{#1}} 


\chapter{Tool Support}
\index{tool support}
\label{chap:ToolsSupport}

%To enable development of high-quality, portable, \emph{first-party} tools
%that support monitoring and performance analysis of OpenMP programs
%developed using any implementation of the OpenMP API, the OpenMP API
%includes a tool interface known as OMPT. 

%OMPD-TODO: rewrite to add debugging interface here. Distrinction of 1st/3rd
%party

This chapter describes OMPT and OMPD, the first-party and third-party
tool interfaces, respectively.
The first segment deals with OMPT, and begins with an overview
of the OMPT interface in Section~\ref{sec:ompt-overview}.
Next, it describes how to initialize (Section~\ref{sec:ompt-initialization})
and finalize (Sections~\ref{sec:ompt-finalization}) a tool.
Subsequent sections describe details of the interface, including
data types shared between an OpenMP implementation and a tool
(Section~\ref{sec:ompt-data-types}), 
an interface that enables an OpenMP implementation to determine that a
tool is available (Section~\ref{sec:tool-interface}),
type signatures for tool callbacks 
that an OpenMP implementation may dispatch for OpenMP events
(Section~\ref{sec:ompt-tool-callbacks}), and 
\emph{runtime entry points}---function interfaces
provided by an OpenMP implementation for use by a tool
(Section~\ref{sec:entry-points}). 

Section~\ref{sec:ompd:ompd-overview} begins the discussion of
OMPD, the third-party tool interface.
Unlike OMPT, the third-party tool exists in a separate process from
the OpenMP program.
In order to minimize any performance overheads, a conforming OpenMP
runtime does not need to maintain any extra information needed only
to allow OMPD to satisfy inquiries from third-party tools
\emph{unless} it is explicitly instructed to do so.
Section~\ref{sec:ompd:activating} discusses the mechanisms for
activating support for OMPD in the OpenMP runtime.
{\bf need something here for the sections in between.}
An OMPD implementation will not interact directly with the OpenMP
runtime for which it is designed to operate.
Instead, the third-party tool must provide the OMPD with a set of
callbacks that the OMPD uses to access the OpenMP runtime.
This interface is given in
Section~\ref{sec:ompd:third-party-tool-callback-interface}.
In general, a third-party's tool's OpenMP-related activity will be
conducted through the OMPD interface.
However, there are a few instances where the third-party tool needs
to access the OpenMP runtime directly;
these cases are discussed in
Section~\ref{sec:ompd:runtime-entry-points-for-ompd}.



% OMPT
\input{tool_support/tool_support_common.tex}
\input{tool_support/tool_support_callbacks.tex}
\input{tool_support/tool_support_entrypoints.tex}

% OMPD
\input{tool_support/tool_support_debug.tex}
