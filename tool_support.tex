% This is tool_support.tex (Chapter 4) of the OpenMP specification.
% This is an included file. See the master file for more information.
%
% When editing this file:
%
%    1. To change formatting, appearance, or style, please edit openmp.sty.
%
%    2. Custom commands and macros are defined in openmp.sty.
%
%    3. Be kind to other editors -- keep a consistent style by copying-and-pasting to
%       create new content.
%
%    4. We use semantic markup, e.g. (see openmp.sty for a full list):
%         \code{}     % for bold monospace keywords, code, operators, etc.
%         \plc{}      % for italic placeholder names, grammar, etc.
%
%    5. There are environments that provide special formatting, e.g. language bars.
%       Please use them whereever appropriate.  Examples are:
%
%         \begin{fortranspecific}
%         This is text that appears enclosed in blue language bars for Fortran.
%         \end{fortranspecific}
%
%         \begin{note}
%         This is a note.  The "Note -- " header appears automatically.
%         \end{note}
%
%    6. Other recommendations:
%         Use the convenience macros defined in openmp.sty for the minor headers
%         such as Comments, Syntax, etc.
%
%         To keep items together on the same page, prefer the use of
%         \begin{samepage}.... Avoid \parbox for text blocks as it interrupts line numbering.
%         When possible, avoid \filbreak, \pagebreak, \newpage, \clearpage unless that's
%         what you mean. Use \needspace{} cautiously for troublesome paragraphs.
%
%         Avoid absolute lengths and measures in this file; use relative units when possible.
%         Vertical space can be relative to \baselineskip or ex units. Horizontal space
%         can be relative to \linewidth or em units.
%
%         Prefer \emph{} to italicize terminology, e.g.:
%             This is a \emph{definition}, not a placeholder.
%             This is a \plc{var-name}.
%

\newcommand{\devicedesc}{
The argument \plc{device} is a pointer to an opaque object that
represents the target device instance. The pointer to the device
instance object is used by functions in the device tracing interface
to identify the device being addressed.
}

\newcommand{\epdesc}{
The argument \plc{endpoint} indicates whether the callback is
signalling the beginning or the end of a scope.
}

\newcommand\codeptrdesc{
The argument \plc{codeptr_ra} is used to relate the implementation
of an OpenMP region back to its source code.  In cases where a runtime
routine implements the region associated with this callback,
\plc{codeptr_ra} is expected to contain the return address of the
call to the runtime routine.  In cases where the implementation of
this feature is inlined, \plc{codeptr_ra} is expected to contain the
return address of the invocation of this callback.  In cases where
attribution to source code is impossible or inappropriate,
\plc{codeptr_ra} may be \code{NULL}.
}


\chapter{Tool Support}
\index{tool support}
\label{chap:ToolsSupport}

%To enable development of high-quality, portable, \emph{first-party} tools
%that support monitoring and performance analysis of OpenMP programs
%developed using any implementation of the OpenMP API, the OpenMP API
%includes a tool interface known as OMPT.

%OMPD-TODO: rewrite to add debugging interface here. Distrinction of 1st/3rd
%party

This chapter describes OMPT and OMPD, which are a pair of interfaces for first-party and third-party
tools, respectively.  Section~\ref{sec:ompt-overview} describes OMPT---an interface for first-party tools.
The section begins with a description of how to initialize (Section~\ref{sec:ompt-initialization})
and finalize (Section~\ref{sec:ompt-finalization}) a tool.
Subsequent sections describe details of the interface, including
data types shared between an OpenMP implementation and a tool
(Section~\ref{sec:ompt-data-types}),
an interface that enables an OpenMP implementation to determine that a
tool is available (Section~\ref{sec:ompt-check-tool}),
type signatures for tool callbacks
that an OpenMP implementation may dispatch for OpenMP events
(Section~\ref{sec:ompt-tool-callbacks}), and
\emph{runtime entry points}---function interfaces
provided by an OpenMP implementation for use by a tool
(Section~\ref{sec:entry-points}).

Section~\ref{sec:ompd-overview} describes
OMPD---an interface for  third-party tools such as debuggers.
Unlike OMPT, a third-party tool exists in a separate process from
the OpenMP program.
An OpenMP implementation need not maintain any extra information to support OMPD inquiries from third-party tools
\emph{unless} it is explicitly instructed to do so.
Section~\ref{subsec:activating} discusses the mechanisms for
activating support for OMPD in the OpenMP runtime.
Section~\ref{subsec:ompd-data-types}  describes the data types shared between the OMPD library and a third-party tool.
Section~\ref{sec:third-party-tool-callback-interface} describes the API provided by the OMPD library for use by a third-party tool.
An OMPD library will not interact directly with the OpenMP
runtime for which it is designed to operate.
Instead, the third-party tool must provide the OMPD library with a set of
callbacks that the OMPD library uses to access the OpenMP runtime.
This interface is given in
Section~\ref{sec:third-party-tool-callback-interface}.
In general, a third-party's tool's OpenMP-related activity will be
conducted through the OMPD interface.
However, there are a few instances where the third-party tool needs
to access the OpenMP runtime directly;
these cases are discussed in
Section~\ref{subsec:runtime-entry-points-for-ompd}.

\section{Tool Interfaces Definitions}
\index{tool interfaces definitions}
\index{tools header files}
\label{sec:tool_interfaces_definitions}

\begin{ccppspecific}

A compliant implementation must supply a set of definitions for the OMPT runtime entry 
points, OMPT callback signatures, OMPD runtime entry points, OMPD tool callback 
signatures, OMPD tool interface routines, and the special data types of their parameters 
and return values.

The set of definitions is provided in a header file named \code{omp-tools.h} and must 
contain a declaration for each of the types defined in 
Sections~\ref{sec:ompt-data-types} - \ref{sec:entry-points} and
\ref{subsec:ompd-data-types} - \ref{subsec:runtime-entry-points-for-ompd}. 

In addition, the set of definitions may specify other implementation specific values.

The \code{ompt_start_tool} function, the \code{ompd_dll_locations} function, all OMPD 
tool interface functions, and all OMPD runtime entry points are external functions with 
``C'' linkage.
	
			
\end{ccppspecific}



% OMPT
\input{tool_support/tool_support_common.tex}
\input{tool_support/tool_support_callbacks.tex}
\input{tool_support/tool_support_entrypoints.tex}

% OMPD
\input{tool_support/tool_support_debug.tex}


\input{tool_support/foundation.tex}
