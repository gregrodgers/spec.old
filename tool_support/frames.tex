\subsubsection{Frames}
\index{frames}
\label{sec:omp_frame_t}

\vbox{
\begin{ccppspecific}
\begin{boxedcode}
typedef struct omp_frame_t \{\\
  void *\plc{exit_frame};
  void *\plc{enter_frame};
\} omp_frame_t;
\end{boxedcode}
\end{ccppspecific}
}

\descr

When executing an OpenMP program, at times, one or more procedure frames associated with
the OpenMP runtime may appear on a thread's stack between frames
associated with tasks. To help a tool determine whether a procedure
frame on the call stack belongs to a task or not,
for each task whose frames appear on the stack, the runtime
maintains an \code{omp\_frame\_t} object 
that indicates a contiguous sequence of 
procedure frames associated with the task.
Each \code{omp\_frame\_t} object is associated with the task to which the procedure frames belong.
Each non-merged initial, implicit, explicit, or target task with one or more frames on a thread's stack
will have an associated \code{omp\_frame\_t} object.



An \code{omp\_frame\_t} object associated with a task contains a pair
of pointers: \plc{exit\_frame} and \plc{enter\_frame}. The field names were
chosen, respectively, to reflect that they typically contain a pointer to a procedure frame on the stack when 
\emph{exiting} the OpenMP runtime into code for a task or \emph{entering} the OpenMP runtime from a task.

The \plc{exit\_frame} field of a task's \code{omp\_frame\_t} object 
contains the canonical frame address for the procedure frame that
transfers control to the structured block for the task. 
The value of \plc{exit\_frame} is \code{NULL} until just prior to
beginning execution of the structured block for the task.
A task's \plc{exit\_frame} may point to a procedure frame that belongs
to the OpenMP runtime or one that belongs to another task.
The \plc{exit\_frame} for the \code{omp\_frame\_t} object associated 
with an \emph{initial task} is \code{NULL}.

The \plc{enter\_frame} field of a task's \code{omp\_frame\_t} object 
contains the canonical frame address of a task procedure frame that invoked the
OpenMP runtime causing the current task to suspend and another task to
execute.
If a task with frames on the stack has not suspended, the value of
\plc{enter\_frame} for the \code{omp\_frame\_t} object 
associated with the task may contain \code{NULL}. 
The value of \plc{enter\_frame} in a task's \code{omp\_frame\_t} is
reset to \code{NULL} just before a suspended task resumes execution.

An \code{omp\_frame\_t}'s lifetime begins when a task is created
and ends when the task is destroyed. Tools should not assume that
a frame structure remains at a constant location in memory throughout
a task's lifetime. A pointer to a task's \code{omp\_frame\_t} object is passed to
some callbacks; a pointer to a task's \code{omp\_frame\_t} object 
can also be retrieved by a tool at any time, including in a signal
handler, by invoking the
\code{ompt\_get\_task\_info} runtime entry point (described in
Section~\ref{sec:ompt_get_task_info}).





\begin{table}
\begin{center}
\caption{Meaning of various states of an \code{omp\_frame\_t}
    object.\label{tab:frame}}
\begin{tabular}{|p{1in}||p{2in}|p{2in}|}
\hline
\plc{exit\_frame} / \plc{enter\_frame} 	state & \plc{enter\_frame} is
\code{NULL}
& \plc{enter\_frame} is non-\code{NULL} \\
\hline
\hline
\plc{exit\_frame} is \code{NULL} & 
case 1)  initial task during execution\newline 
case 2) task that is created but not yet scheduled or already finished & 
initial task suspended while another task executes
\\\hline
\plc{exit\_frame} is non-\code{NULL} 	& non-initial task that has
been scheduled &
non-initial task 
suspended while another task executes
\\\hline
\end{tabular}
\vspace{1ex}
\end{center}
\end{table}

Table~\ref{tab:frame} describes various states in which 
an \code{omp\_frame\_t} object may be observed and their meaning.
In the presence of nested parallelism, a tool may
observe a sequence of \code{omp\_frame\_t} objects for a thread.
Appendix~\ref{chap:frames} illustrates 
use of \code{omp\_frame\_t} objects with nested parallelism.

\needspace{6\baselineskip}\begin{note}
A monitoring tool using asynchronous sampling can observe values
of \plc{exit\_frame} and \plc{enter\_frame} at inconvenient times.
Tools must be prepared to observe and handle \code{omp\_frame\_t}
objects observed just prior to when their field values will be set or
cleared.
\end{note}
