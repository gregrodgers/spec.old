\section{OMPD Interface}
\label{sec:OMPD Interface}
\label{chap:OMPD Interface}
\label{sec:ompd-overview}

This chapter describes OMPD, which is an interface for \emph{third-party} tools.
\emph{Third-party} tools exist in separate processes from the OpenMP program.
To provide OMPD support, an OpenMP implementation must provide an OMPD library to
be loaded by the \emph{third-party} tool. An OpenMP implementation does not need
to maintain any extra information to support OMPD inquiries from \emph{third-party}
tools \emph{unless} it is explicitly instructed to do so.

OMPD allows \emph{third-party tools} such as a debuggers to inspect the 
OpenMP state of a live program or core file in an implementation-agnostic 
manner. That is, a tool that uses OMPD should work with any conforming 
OpenMP implementation. An OpenMP implementor provides a library for OMPD 
that a third-party tool can dynamically load. Using the interface exported 
by the OMPD library, the external tool can inspect the OpenMP state of a 
program. In order to satisfy requests from the third-party tool, the OMPD 
library may need to read data from, or to find the addresses of symbols in 
the OpenMP program. The OMPD library provides this functionality through a 
callback interface that the third-party tool must instantiate for the OMPD library.

To use OMPD, the third-party tool loads the OMPD library. The OMPD library exports 
the API that is defined throughout this section and that the tool uses to 
determine OpenMP information about the OpenMP program. The OMPD library must
look up the symbols and read data out of the program. It does not perform
these operations directly, but instead it use the callback interface that the
tool exports to cause the tool to perform them.

The OMPD architecture insulates tools from the internal structure of the 
OpenMP runtime while the OMPD library is insulated from the details of how 
to access the OpenMP program. This decoupled design allows for flexibility in how 
the OpenMP program and tool are deployed, so that, for example, the tool and the 
OpenMP program are not required to execute on the same machine.

Generally the tool does not interact directly with the OpenMP runtime and, 
instead, interacts with it through the OMPD library. However, a few cases
require the tool to access the OpenMP runtime directly. These cases fall into 
two broad categories. The first is during initialization, where the tool must
look up symbols and read variables in the OpenMP runtime in order to identify 
the OMPD library that it should use, which is discussed in 
\specref{subsubsec:ompd_dll_locations} and 
\specref{subsubsec:ompd_dll_locations_valid}. The second category relates to 
arranging for the tool to be notified when certain events occur during the 
execution of the OpenMP program. For this purpose, the OpenMP implementation
must define certain symbols in the runtime code, as is discussed in 
\specref{subsec:runtime-entry-points-for-ompd}. Each of these symbols corresponds 
to an event type. The runtime must ensure that control passes through the 
appropriate named location when events occur. If the tool requires notification 
of an event, it can plant a breakpoint at the matching location. The location 
can, but may not, be a function. It can, for example, simply be a label. However, 
the names of the locations must have external \code{C} linkage.

\subsection{OMPD Interfaces Definitions}
\index{tool interfaces definitions}
\index{tools header files}
\label{sec:OMPD Interfaces Definitions}

\begin{ccppspecific}
A compliant implementation must supply a set of definitions for the OMPD runtime
entry points, OMPD tool
callback signatures, OMPD tool interface routines, and the special data types of
their parameters and return values. These definitions, which are listed throughout
this chapter, and their associated declarations shall be provided in a header file
named \code{omp-tools.h}. In addition, the set of definitions may specify other
implementation-specific values.

The \code{ompd_dll_locations} function,
all OMPD tool interface functions, and all OMPD runtime entry points are
external functions with \code{C} linkage.
\end{ccppspecific}

