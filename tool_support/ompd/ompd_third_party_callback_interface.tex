\section{Third-party Tool Callback Interface}
\label{sec:ompd:third-party-tool-callback-interface}

For the OMPD plugin to provide information about the internal state
of the OpenMP runtime system in an OpenMP process or core file,
it must have a means to extract information from
the tool's target.
The tool's target ``process'' may be a ``live'' process or a core file,
and a target thread may be a ``live'' thread in a process,
or a thread in a core file.
To enable OMPD to extract state information from a target process or core file,
the third-party tool must supply the OMPD with callback functions to inquire
about the size of primitive types in the target,
look up the addresses of symbols,
as well as read and write memory in the target.
OMPD then uses these callbacks to implement its interface operations.
Signatures for the third-party tool callbacks used by OMPD are given below.

\subsection{Memory Management}

The OMPD plugin \emph{must} obtain and release heap memory \emph{only}
using the callbacks provided to it by the third-party tool.
It must \emph{not} call the heap manager directly using \code{malloc}.
For C++ implementations of OMPD this means that \code{new},
\code{new(throw)}, \code{new[]}, \code{delete}, \code{delete(throw)},
and \code{delete[]} in \emph{all} their variants \emph{must} be overloaded,
and implemented in terms of the callback functions
provided to it by the third-party tool.

\subsubsection{Memory Allocation Callback}
\label{sec:ompd:ompd_dmemory_alloc_fn_t}
\index{ompd\_dmemory\_alloc\_fn\_t@{\code{ompd\_dmemory\_alloc\_fn\_t}}}

\summary
The type signature of the callback routine provided by the third-tool
to be used by the OMPD plugin to allocate memory.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_dmemory\_alloc\_fn\_t) (
  ompd\_size\_t   \plc{nbytes},
  void        **\plc{ptr}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The argument \plc{nbytes} gives the size in bytes of the block of memory the
OMPD wants allocated.

On success, the third-party tool returns \code{ompd\_rc\_ok} as the
return value of the callback, and the address of the newly allocated
block in \plc{*ptr}.
The newly allocated block is suitably aligned for any type of variable,
and is not guaranteed to be zeroed.

On failure an error code from \code{ompd\_rc\_t} is returned by the callback.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_size\_t}, \specref{ompd:ompd_size_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsubsection{Memory Deallocation Callback}
\label{sec:ompd:ompd_dmemory_free_fn_t}
\index{ompd\_dmemory\_free\_fn\_t@{\code{ompd\_dmemory\_free\_fn\_t}}}

\summary
The type signature of the callback routine provided by the third-party
tool to be used by the OMPD plugin to deallocate memory.

\vbox{
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_dmemory\_free\_fn\_t) (
  void    *\plc{ptr}
);
\end{boxedcode}
\cspecificend
}

\argdesc
\plc{ptr} is the adderss of the block to be released.
The block must have been previously allocated using the allocation callback
provided by the third-party tool to the OMPD plugin.

On success, \code{ompd\_rc\_ok} is returned by the callback to the OMPD plugin.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Context Management and Navigation}

The third-party tool provides the OMPD plugin with callbacks
to manage and navigate context relationships.

\subsubsection{Context Management}
\label{sec:ompd:ompd_get_thread_context_for_osthread_fn_t}
% the use of \discretionary below overrides the character used for
% hyphenation when an optional linebreak is used.
% if \- were used, we'd get a "-" at the end of the line being
% broken.  We probably don't wantthat, but instead want just a plain
% linebreak without the "-".
\index{ompd\_get\_thread\_context\_for\_osthread\_fn\_t@{\code{ompd\_get\_thread\_context\_for\_\discretionary{}{}{}osthread\_fn\_t}}}

\summary
The type signature of the callback routine provided by the third-party
tool the OMPD plugin can use to map an operating system thread handle
to a tool \plc{thread context}.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_get\_thread\_context\_for\_osthread\_fn\_t) (
  \code{ompd\_address\_space\_context\_t}  *\plc{address\_space\_context},
  \code{ompd\_osthread\_kind\_t}           \plc{kind},
  \code{ompd\_size\_t}                    \plc{sizeof\_osthread},
  const void                    *\plc{osthread},
  \code{ompd\_thread\_context\_t}        **\plc{thread\_context}
);
\end{boxedcode}
\cspecificend
}

\argdesc
This callback maps an operating system thread handle within the address
space identified by \plc{address\_space\_context} to a tool thread context.
The operating system thread is identified by the combination
\plc{kind}, \plc{sizeof\_osthread}, and \plc{osthread} arguments.

On success the tool \plc{thread context} is returned in \plc{*thread\_context}.
The \plc{thread context} is created, and remains owned, by the tool.
The OMPD plugin can assume that the \plc{thread context} is valid for
as long as the tool is holding any references to \plc{thread handles}
that may contain the \plc{thread context}.
The OMPD implementation can use the \plc{thread context} to access
thread local storage (TLS).

On failure, the callback returns an error code from \code{ompd\_rc\_t}.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_osthread\_kind\_t}, \specref{ompd:ompd_osthread_kind_t}
\item
  \code{ompd\_size\_t}, \specref{ompd:ompd_size_t}
\item
  \code{ompd\_thread\_context\_t}, \specref{ompd:ompd_thread_context_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\item
  \code{ompd\_tmemory\_read\_fn\_t}, \specref{sec:ompd:ompd_tmemory_read_fn_t}
\item
  \code{ompd\_tmemory\_write\_fn\_t}, \specref{sec:ompd:ompd_tmemory_write_fn_t}
\end{itemize}

\subsubsection{Context Navigation}
\label{sec:ompd:ompd_get_address_space_context_for_thread_fn_t}
% the use of \discretionary below overrides the character used for
% hyphenation when an optional linebreak is used.
% if \- were used, we'd get a "-" at the end of the line being
% broken.  We probably don't wantthat, but instead want just a plain
% linebreak without the "-".
\index{ompd\_get\_address\_space\_context\_for\_thread\_fn\_t@{\code{ompd\_get\_address\_space\_context\_\discretionary{}{}{}for\_thread\_fn\_t}}}

\summary
The type signature of the callback routine provided by the third-party
tool the OMPD plugin can use to find the address space context
for a thread identified by a thread context.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t
  (*ompd\_get\_address\_space\_context\_for\_thread\_fn\_t) (
    \code{ompd\_thread\_context\_t}          *\plc{thread\_context},
    \code{ompd\_address\_space\_context\_t}  **\plc{address\_space\_context}
);
\end{boxedcode}
\cspecificend
}

\argdesc

This callback finds the tool address space context for the thread
identified by the tool thread context \plc{thread\_context}.
On success, the callbacks returns \code{ompd\_rc\_ok},
and the context in \plc{*address\_space\_context}.
If \plc{thread\_context} refers to a host device thread,
this function returns the context for the host address space.
If \plc{thread\_context} referes to a target device thread,
this function returns the target device's address space.

On failure, the callback returns an error code from \code{ompd\_rc\_t}.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_thread\_context\_t}, \specref{ompd:ompd_thread_context_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Sizes of Primitive Types}

The third-party tool provides the OMPD plugin with callbacks
to discover information about the sizes of the basic primitive types
in an address space.
This information is important to an OMPD plugin because the architecture
or programming model of the OpenMP runtime it is examining may be different
from the its own and that of the third-party tool which loaded it.
On platforms with multiple programming models, an OMPD plugin may need
to be able to handle OpenMP runtimes using different sizes for the
basic types.

\crossreferences
\begin{itemize}
\item
  OMPD --- Overivew, \specref{sec:ompd:ompd-overview}
\end{itemize}

\subsubsection{Representation of the Sizes of the Basic Types}
\label{sec:ompd:ompd_target_type_sizes_t}
\index{ompd\_target\_sizes\_t@{\code{ompd\_target\_sizes\_t}}}

\summary
The defintion of the type that represents the sizes of the basic types
used by an OpenMP program.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef struct \{
  int  \plc{sizeof\_char};
  int  \plc{sizeof\_short};
  int  \plc{sizeof\_int};
  int  \plc{sizeof\_long};
  int  \plc{sizeof\_long\_long};
  int  \plc{sizeof\_pointer};
\} ompd\_target\_type\_sizes\_t;
\end{boxedcode}
\cspecificend
}

\descr
The fields of \code{ompd\_target\_type\_sizes\_t} give the sizes of
the eponymous basic types used by the OpenMP runtime.
As the third-party tool and the OMPD plugin, by definition, have the same
architecture and programming model, the size of the fields can be given
as \code{int}.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_tsizeof\_fn\_t}, \specref{sec:ompd:ompd_tsizeof_fn_t}
\end{itemize}

\subsubsection{Callback to get the Sizes of the Primitive Types}
\label{sec:ompd:ompd_tsizeof_fn_t}
\index{ompd\_tsizeof\_fn\_t@{\code{ompd\_tsizeof\_fn\_t}}}

\summary
The type signature of the callback routine provided by the third-party
tool the OMPD plugin can use to find the sizes of the primitive types
in an address space.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_tsizeof\_fn\_t) (
    \code{ompd\_address\_space\_context\_t}  *\plc{address\_space\_context},
    \code{ompd\_target\_type\_sizes\_t}      *\plc{sizes}
);
\end{boxedcode}
\cspecificend
}

\argdesc

On success, the callback returns \code{ompd\_rc\_ok}, and the sizes of
the basic primitive types used by the \plc{address\_space\_context}
are returned through \plc{*sizes}.
Otherwise, an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_target\_type\_sizes\_t}, \specref{sec:ompd:ompd_target_type_sizes_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Symbol lookup}
\label{sec:ompd:ompd_tsymbol_addr_fn_t}
\index{ompd\_tsymbol\_addr\_fn\_t@{\code{ompd\_tsymbol\_addr\_fn\_t}}}

\summary
The type signature of the callback provided by the third-party tool the
OMPD plugin can use to look up the addresses of symbols in an OpenMP program.


\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_tsymbol\_addr\_fn\_t) (
    ompd\_address\_space\_context\_t  *\plc{address\_space\_context},
    ompd\_thread\_context\_t         *\plc{thread\_context},
    const char                    *\plc{symbol\_name},
    ompd\_address\_t                *\plc{symbol\_addr}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The OMPD plugin may want to look up the addresses of symbols in
the OpenMP program in order to locate information it needs to satisfy
requests from the third-party tool.
This callback looks up the symbol \plc{symbol\_name}.
The \plc{thread\_context} is optional for global memory access,
and should be NULL in this case.
If \plc{thread\_context} is not NULL, it gives the thread specific
context for the symbol lookup, for the purpose of calculating thread
local storage~(TLS) addresses.

The \plc{symbol\_name} supplied by the OMPD plugin is used verbatim by
the third-party tool, and in particular, no name mangling, demangling
or other transformations are performed prior to the lookup.

On success, the callback returns \code{ompd\_rc\_ok} and the address
of the symbol in \plc{*symbol\_addr}.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd-address-space-context-t}
\item
  \code{ompd\_thread\_context\_t}, \specref{sec:ompd:ompd_thread_context_t}
\item
  \code{ompd\_address\_t}, \specref{ompd:ompd_address_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Accessing Memory in the OpenMP Program or Runtime}

The OMPD plugin may need to read from, or write to, the OpenMP program.
It cannot do this directly, but instead must use the callbacks provided
to it by the third-party tool, which will perform the operation
on its behalf.

\subsubsection{Reading Memory}
\label{sec:ompd:ompd_tmemory_read_fn_t}
\index{ompd\_tmemory\_read\_fn\_t@{\code{ompd\_tmemory\_read\_fn\_t}}}

\summary

The type signature of the callback provided by the third-party tool the
OMPD plugin can use to read data out of an OpenMP program.


\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_tmemory\_read\_fn\_t) (
    ompd\_address\_space\_context\_t  *\plc{address\_space\_context},
    ompd\_thread\_context\_t         *\plc{thread\_context},
    const ompd\_address\_t          *\plc{addr},
    ompd\_word\_t                    \plc{nbytes},
    void                          *\plc{buffer}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The address from which the data are to be read out of the OpenMP program
specified by \plc{address\_space\_context} is given by \plc{addr}.
\plc{nbytes} gives the number of bytes to be transfered.
The \plc{thread\_context} argument is optional for global memory access,
and in this case should be NULL.
If it is not NULL, \plc{thread\_context} identifies the thread
specific context for the memory access for the purpose of accessing
thread local storage (TLS).

The data are returned through \plc{buffer}, which is allocated and
owned by the OMPD plugin.
The contents of the buffer are unstructured, raw bytes.
It is the responsibility of the OMPD plugin to arrange for
any transformations such as byte-swapping that may be necessary
(see~\specref{sec:ompd:ompd_target_host_fn_t}) to interpret the
data returned.

On success, \code{ompd\_rc\_ok} is returned.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_thread\_context\_t}, \specref{sec:ompd:ompd_thread_context_t}
\item
  \code{ompd\_address\_t}, \specref{ompd:ompd_address_t}
\item
  \code{ompd\_tword\_t}, \specref{ompd:ompd_tword_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_target\_host\_fn\_t}, \specref{sec:ompd:ompd_target_host_fn_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsubsection{Writing Memory}
\label{sec:ompd:ompd_tmemory_write_fn_t}
\index{ompd\_tmemory\_write\_fn\_t@{\code{ompd\_tmemory\_write\_fn\_t}}}

\summary

The type signature of the callback provided by the third-party tool the
OMPD plugin can use to write data to an OpenMP program.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_tmemory\_write\_fn\_t) (
    ompd\_address\_space\_context\_t  *\plc{address\_space\_context},
    ompd\_thread\_context\_t         *\plc{thread\_context},
    const ompd\_address\_t          *\plc{addr},
    ompd\_word\_t                    \plc{nbytes},
    const void                    *\plc{buffer}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The address to which the data are to be writen in the OpenMP program
specified by \plc{address\_space\_context} is given by \plc{addr}.
\plc{nbytes} gives the number of bytes to be transfered.
The \plc{thread\_context} argument is optional for global memory access,
and in this case should be NULL.
If it is not NULL, \plc{thread\_context} identifies the thread
specific context for the memory access for the purpose of accessing
thread local storage (TLS).

The data to be written are passed through \plc{buffer}, which is allocated and
owned by the OMPD plugin.
The contents of the buffer are unstructured, raw bytes.
It is the responsibility of the OMPD plugin to arrange for
any transformations such as byte-swapping that may be necessary
(see~\specref{sec:ompd:ompd_target_host_fn_t})
to render the data into a form compatible with the OpenMP runtime.

On success, \code{ompd\_rc\_ok} is returned.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t} \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_thread\_context\_t}, \specref{sec:ompd:ompd_thread_context_t}
\item
  \code{ompd\_address\_t}, \specref{ompd:ompd_address_t}
\item
  \code{ompd\_tword\_t}, \specref{ompd:ompd_tword_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_target\_host\_fn\_t}, \specref{sec:ompd:ompd_target_host_fn_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Data Format Conversion}
\label{sec:ompd:data-format-conversion}

The architecuture and/or programming-model of third-party tool and
OMPD plugin may be different from that of the OpenMP program being
examined.
Consequently, the conventions for representing data will differ.
The callback interface includes operations for converting between
the conventions, such as byte order (`endianness'),
used by the third-party tool and OMPD plugin on the
one hand, and the OpenMP program on the other.

\subsubsection{Primitive Data Types}
\label{sec:ompd:primitive-data-types}
\index{ompd\_target\_prim\_types\_t@{\code{ompd\_target\_prim\_types\_t}}}

\summary
The enumeration that identifies the primitive types for data format
conversion.

\textsl{\Large Do we need this?  Where is this used?}

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef enum \{
  ompd\_type\_char          = 0,
  ompd\_type\_short         = 1,
  ompd\_type\_int           = 2,
  ompd\_type\_long          = 3,
  ompd\_type\_long_long     = 4,
  ompd\_type\_pointer       = 5
\} ompd\_target\_prim\_types\_t;
\end{boxedcode}
\cspecificend
}

\descr
The members of this enumeration identify the basic types known
to the OMPD interface.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_target\_host\_fn\_t}, \specref{sec:ompd:ompd_target_host_fn_t}
\end{itemize}

\subsubsection{Data Conversion}
\label{sec:ompd:ompd_target_host_fn_t}
\index{ompd\_target\_host\_fn\_t@{\code{ompd\_target\_host\_fn\_t}}}

\summary

The type signature of the callback provided by the third-party tool the
OMPD plugin can use to convert data between the formats used by the
third-part tool and OMPD plugin, and the OpenMP program.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_target\_host\_fn\_t) (
    ompd\_address\_space\_context\_t  *\plc{address\_space\_context},
    const void                    *\plc{input},
    int                            \plc{unit\_size},
    int                            \plc{count},
    void                          *\plc{output}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The OpenMP address space associated with the data is given by
\plc{address\_space\_context}.
The source and destination buffers are given by \plc{input}
and \plc{output}, respectively.
\plc{unit\_size} gives the size of each of the elements to be converted.
\plc{count} is the number of elements to be transformed.

The input and output buffers are allocated and owned by the OMPD plugin,
and it is its responsibility to ensure that the buffers are the correct
size, and eventually deallocated when they are no longer needed.

On success, \code{ompd\_rc\_ok} is returned.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_address\_space\_context\_t}, \specref{ompd:ompd_address_space_context_t}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{Emitting Output}
\label{sec:ompd:ompd_print_string_fn_t}
\index{ompd\_print\_string\_fn\_t@{\code{ompd\_print\_string\_fn\_t}}}

\summary

The type signature of the callback provided by the third-party tool the
OMPD plugin can use to emit output.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef ompd\_rc\_t (*ompd\_print\_string\_fn\_t) (
    const char        *\plc{string}
);
\end{boxedcode}
\cspecificend
}

\argdesc
The OMPD plugin emits output, such as logging or debug information,
using a callback supplied to it by the third-party tool.
It should not emit output directly.

\plc{string} is the string to be printed.
No conversion or formating is performed on the string.

On success, \code{ompd\_rc\_ok} is returned.
Otherwise, on failure an error code from \code{ompd\_rc\_t} is returned.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_rc\_t}, \specref{ompd:ompd_rc_t}
\item
  \code{ompd\_callbacks\_t}, \specref{ompd:ompd_callbacks_t}
\end{itemize}

\subsection{The Callback Interface}
\label{ompd:ompd_callbacks_t}
\index{ompd\_callbacks\_t@{\code{ompd\_callbacks\_t}}}

\summary

All the OMPD plugin's interactions with the OpenMP program
must be through a set of callbacks provided to it by the
third-party tool which loaded it.
These callbacks must also be used for allocating or releasing resources,
such as memory, that the plugin needs.

\vbox{
% the odd-looking spacing between type and argument name ensures
% they line up in the pdf
\cspecificstart
\begin{boxedcode}
typedef struct \{
  ompd\_dmemory\_alloc\_fn\_t   \plc{d\_alloc\_memory};
  ompd\_dmemory\_free\_fn\_t    \plc{d\_free\_memory};
  ompd\_print\_string\_fn\_t    \plc{print\_string};
  ompd\_tsizeof\_prim\_fn\_t    \plc{t\_sizeof\_prim\_type};
  ompd\_tsymbol\_addr\_fn\_t    \plc{t\_symbol\_addr\_lookup};
  ompd\_tmemory\_read\_fn\_t    \plc{t\_read\_memory};
  ompd\_tmemory\_write\_fn\_t   \plc{t\_write\_memory};
  ompd\_target\_host\_fn\_t     \plc{target\_to\_host};
  ompd\_target\_host\_fn\_t     \plc{host\_to\_target};
  ompd\_get\_thread\_context\_for\_osthread\_fn\_t
                            \plc{get\_thread\_context\_for\_osthread}:
  ompd\_get\_address\_space\_context\_for\_thread\_fn\_t
                            \plc{get\_address\_space\_context\_for\_thread};
\} ompd\_callbacks\_t;
\end{boxedcode}
\cspecificend
}

\descr
The set of callbacks the OMPD plugin should use is collected
in the \code{ompd\_callbacks\_t} record structure.
An instance of this type is passed to the OMPD plugin
as a parameter to \code{ompd\_initialize}.
Each field points to a function that the OMPD plugin should use
for interacting with the OpenMP program, or getting memory from
the third-party tool.

The \plc{d\_alloc\_memory} and \plc{d\_free\_memory} fields are
pointers to functions the OMPD plugin uses to allocate and release
dynamic memory.

\plc{print\_string} points to a function that prints a string.

The architectures or programming models of the OMPD plugin and
third party tool may be different from that of the OpenMP
program being examined.
\plc{t\_sizeof\_prim\_type} points to function that allows
the OMPD plugin to determine the sizes of the basic integer
and pointer types used by the OpenMP program.
Because of the differences in architecture or programming model,
the conventions for representing data in the OMPD plugin and
the OpenMP program may be different.
The \plc{target\_to\_host} field points to a function which translates
data from the conventions used by the OpenMP program to that used
by the third-party tool and OMPD plugin.
The reverse operation is performed by the function pointed
to by the \plc{host\_to\_target} field.

The OMPD plugin may need to access memory in the OpenMP program.
The \plc{t\_symbol\_addr\_lookup} field points to a callback the
OMPD plugin can use to find the address of a global or thread
local storage (TLS) symbol.
The \plc{t\_read\_memory} and \plc{t\_write\_memory} fields are
pointers to functions for reading from, and writing to, global or TLS
memory in the OpenMP program, respectively.

\plc{get\_thread\_context\_for\_osthread} is a pointer to a function
the OMPD plugin can use to obtain a tool context that corresponds to
an operating system id.
\plc{get\_address\_space\_context\_for\_thread} points to a callback
the OMPD plugin can use to get the tool context that `owns' the
thread represented by a tool thread context.

\crossreferences
\begin{itemize}
\item
  \code{ompd\_dmemory\_alloc\_fn\_t}, \specref{sec:ompd:ompd_dmemory_alloc_fn_t}
\item
  \code{ompd\_dmemory\_free\_fn\_t}, \specref{sec:ompd:ompd_dmemory_free_fn_t}
\item
  \code{ompd\_print\_string\_fn\_t}, \specref{sec:ompd:ompd_print_string_fn_t}
\item
  \code{ompd\_tsizeof\_prim\_fn\_t}, \specref{sec:ompd:ompd_tsizeof_fn_t}
\item
  \code{ompd\_tsymbol\_addr\_fn\_t}, \specref{sec:ompd:ompd_tsymbol_addr_fn_t}
\item
  \code{ompd\_tmemory\_read\_fn\_t}, \specref{sec:ompd:ompd_tmemory_read_fn_t}
\item
  \code{ompd\_tmemory\_write\_fn\_t}, \specref{sec:ompd:ompd_tmemory_write_fn_t}
\item
  \code{ompd\_target\_host\_fn\_t}, \specref{sec:ompd:ompd_target_host_fn_t}
\item
  \code{ompd\_get\_thread\_context\_for\_osthread\_fn\_t}, \specref{sec:ompd:ompd_get_thread_context_for_osthread_fn_t}
\item
  \code{ompd\_get\_address\_space\_context\_for\_thread\_fn\_t}, \specref{sec:ompd:ompd_get_address_space_context_for_thread_fn_t}
\end{itemize}

