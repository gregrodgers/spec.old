
\subsection{OMPD Tool Interface Routines}
\label{subsec:ompd-api}

\subsubsection{Per OMPD Library Initialization and Finalization}

The OMPD library must be initialized exactly once after it is loaded, 
and finalized exactly once before it is unloaded. Per OpenMP process 
or core file initialization and finalization are also required.

Once loaded, the tool can determine the version of the OMPD API that 
the library supports by calling \code{ompd_get_api_version} (see
\specref{subsubsubsec:ompd_get_api_version}). If the tool supports the 
version that \code{ompd_get_api_version} returns, the tool starts the 
initialization by calling \code{ompd_initialize} (see
\specref{subsubsubsec:ompd_initialize}) using the version of the OMPD API 
that the library supports. If the tool does not support the version that
\code{ompd_get_api_version} returns, it may attempt to call 
\code{ompd_initialize} with a different version.



\subsubsubsection{\hcode{ompd_initialize}}
\label{subsubsubsec:ompd_initialize}

\summary
The \code{ompd_initialize} function initializes the OMPD library.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_initialize(
  ompd_word_t \plc{api_version},
  const ompd_callbacks_t *\plc{callbacks}
);
\end{ompSyntax}
\end{cspecific}

\descr
A tool that uses OMPD calls \code{ompd_initialize} to initialize each OMPD 
library that it loads. More than one library may be present in a third-party 
tool, such as a debugger, because the tool may control multiple devices, which
may use different runtime systems that require different OMPD libraries. This 
initialization must be performed exactly once before the tool can begin to 
operate on an OpenMP process or core file.

\argdesc
The \plc{api_version} argument is the OMPD API version that the tool requests
to use. The tool may call \code{ompd_get_api_version} to obtain the latest 
version that the OMPD library supports.

The tool provides the OMPD library with a set of callback functions in the 
\plc{callbacks} input argument which enables the OMPD library to allocate and 
to deallocate memory in the tool's address space, to lookup the sizes of basic 
primitive types in the device, to lookup symbols in the device, and to read and 
to write memory in the device.

\crossreferences
\begin{itemize}
\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_callbacks_t} type, see \specref{subsubsec:ompd_callbacks_t}.

\item \code{ompd_get_api_version} call, 
see \specref{subsubsubsec:ompd_get_api_version}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_api_version}}
\label{subsubsubsec:ompd_get_api_version}

\summary
The \code{ompd_get_api_version} function returns the OMPD API version.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_api_version(ompd_word_t *\plc{version});
\end{ompSyntax}
\end{cspecific}

\descr
The tool may call the \code{ompd_get_api_version} function to obtain the 
latest OMPD API version number of the OMPD library.

\argdesc
The latest version number is returned in to the location to which the 
\plc{version} argument points.

\crossreferences
\begin{itemize}
\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_version_string}}
\label{subsubsubsec:ompd_get_version_string}

\summary
The \code{ompd_get_version_string} function returns a descriptive 
string for the OMPD API version.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_version_string(const char **\plc{string});
\end{ompSyntax}
\end{cspecific}


\descr
The tool may call this function to obtain a pointer to a descriptive 
version string of the OMPD API  version.

\argdesc
A pointer to a descriptive version string is placed into the location
to which \plc{string} output argument points. The OMPD library owns the string 
that the OMPD library returns; the tool must not modify or release this string.
The string remains valid for as long as the library is loaded. The
\code{ompd_get_version_string} function may be called before 
\code{ompd_initialize} (see \specref{subsubsubsec:ompd_initialize}).
Accordingly, the OMPD library must not use heap or stack memory for the string.

The signatures of \code{ompd_get_api_version} (see
\specref{subsubsubsec:ompd_get_api_version}) and \code{ompd_get_version_string} 
are guaranteed not to change in future versions of the API. In contrast, the 
type definitions and prototypes in the rest of the API do not carry the same 
guarantee. Therefore a tool that uses OMPD should check the version of the API 
of the loaded OMPD library before it calls any other function of the API.

\crossreferences
\begin{itemize}
\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_finalize}}
\label{subsubsubsec:ompd_finalize}

\summary
When the tool is finished with the OMPD library it should call 
\code{ompd_finalize} before it unloads the library.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_finalize(void);
\end{ompSyntax}
\end{cspecific}

\descr
The call to \code{ompd_finalize}is must be the last OMPD call that the tool 
makes before it unloads the library. This call allows the OMPD library to
free any resources that it may be holding.

The OMPD library may implement a \emph{finalizer} section, which executes
as the library is unloaded, and therefore after the call to \code{ompd_finalize}. 
During finalization, the OMPD library may use the callbacks that tool earlier 
provided after the call to \code{ompd_initialize}.

\crossreferences
\begin{itemize}
\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsection{Per OpenMP Process Initialization and Finalization}



\subsubsubsection{\hcode{ompd_process_initialize}}
\label{subsubsubsec:ompd_process_initialize}
\summary
A tool calls \code{ompd_process_initialize} to obtain an address space 
handle when it initializes a session on a live process or core file.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_process_initialize(
  ompd_address_space_context_t *\plc{context},
  ompd_address_space_handle_t **\plc{handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
A tool calls \code{ompd_process_initialize} to obtain an address space 
handle when it initializes a session on a live process or core file.
On return from \code{ompd_process_initialize}, the tool owns the address
space handle, which it must release with \code{ompd_rel_address_space_handle}.
The initialization function must be called before any OMPD operations
are performed on the OpenMP process. This call allows the OMPD library 
to confirm that it can handle the OpenMP process or core file that the 
\plc{context} identifies. Incompatibility is signaled by a 
return value of \code{ompd_rc_incompatible}. 

\argdesc
The \plc{context} argument is an opaque handle that the tool provides to 
address an address space. On return, the \plc{handle} argument provides 
an opaque handle to the tool for this address space, which the tool must
release when it is no longer needed.

\crossreferences
\begin{itemize}
\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_address_space_context_t} type, 
see \specref{subsubsec:ompd_address_space_context_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_address_space_handle} type, 
see \specref{subsubsubsec:ompd_rel_address_space_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_device_initialize}}
\label{subsubsubsec:ompd_device_initialize}

\summary
A tool calls \code{ompd_device_initialize} to obtain an address space 
handle for a device that has at least one  active target region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_device_initialize(
  ompd_address_space_handle_t *\plc{process_handle},
  ompd_address_space_context_t *\plc{device_context},
  omp_device_t \plc{kind},
  ompd_size_t \plc{sizeof_id},
  void *\plc{id},
  ompd_address_space_handle_t **\plc{device_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
A tool calls \code{ompd_device_initialize} to obtain an address space 
handle for a device that has at least one  active target region. On return 
from \code{ompd_device_initialize}, the tool owns the address space handle.

\argdesc
The \plc{process_handle} argument is an opaque handle that the tool provides
to reference the address space of the OpenMP process. The \plc{device_context} 
argument is an opaque handle that the tool provides to reference a device 
address space. The \plc{kind}, \plc{sizeof_id}, and \plc{id} arguments represent 
a device identifier. On return the \plc{device_handle} argument provides an 
opaque handle to the tool for this address space.

\crossreferences
\begin{itemize}
\item \code{ompd_size_t} type, see \specref{subsubsubsec:ompd_size_t}.

\item \code{omp_device_t} type, see \specref{ompd:omp_device_t}.

\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_address_space_context_t} type, 
see \specref{subsubsec:ompd_address_space_context_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_rel_address_space_handle}}
\label{subsubsubsec:ompd_rel_address_space_handle}

\summary
A tool calls \code{ompd_rel_address_space_handle} to release an address space
handle.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_rel_address_space_handle(
  ompd_address_space_handle_t *\plc{handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
When the tool is finished with the OpenMP process address space handle it
should call \code{ompd_rel_address_space_handle} to release the handle, 
which allows the OMPD library to release any resources that it has related 
to the address space.

\argdesc
The \plc{handle} argument is an opaque handle for the address space to be released.

\restrictions
The \code{ompd_rel_address_space_handle} has the following restriction:

\begin{itemize}
\item An address space context must not be used after the corresponding 
      address space handle is released.
\end{itemize}

\crossreferences
\begin{itemize}
\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsection{Thread and Signal Safety}

The OMPD library does not need to be reentrant. The tool must ensure that only 
one thread enters the OMPD library at a time. The OMPD library must not install 
signal handlers or otherwise interfere with the tool's signal configuration.



\subsubsection{Address Space Information}

\subsubsubsection{\hcode{ompd_get_omp_version}}
\label{subsubsubsec:ompd_get_omp_version}

\summary
The tool may call the \code{ompd_get_omp_version} function to obtain the version 
of the OpenMP API that is associated with an address space.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_omp_version(
  ompd_address_space_handle_t *\plc{address_space},
  ompd_word_t *\plc{omp_version}
);
\end{ompSyntax}
\end{cspecific}

\descr
The tool may call the \code{ompd_get_omp_version} function to obtain the 
version of the OpenMP API that is associated with the address space.

\argdesc
The \plc{address_space} argument is an opaque handle that the tool provides
to reference the address space of the OpenMP process or device.

Upon return, the \plc{omp_version} argument contains the version of the OpenMP 
runtime in the \code{_OPENMP} version macro format.

\crossreferences
\begin{itemize}
\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_omp_version_string}}
\label{subsubsubsec:ompd_get_omp_version_string}

\summary
The \code{ompd_get_omp_version_string} function returns a descriptive 
string for the OpenMP API version that is associated with an address space.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_omp_version_string(
  ompd_address_space_handle_t *\plc{address_space},
  const char **\plc{string}
);
\end{ompSyntax}
\end{cspecific}

\descr
After initialization, the tool may call the \code{ompd_get_omp_version_string} 
function to obtain the version of the OpenMP API that is associated with an 
address space.

\argdesc
The \plc{address_space} argument is an opaque handle that the tool provides
to reference the address space of the OpenMP process or device. A pointer to 
a descriptive version string is placed into the location to which the 
\plc{string} output argument points. After returning from the call, the tool 
owns the string. The OMPD library must use the memory allocation callback that 
the tool provides to allocate the string storage. The tool is responsible 
for releasing the memory.

\crossreferences
\begin{itemize}
\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsection{Thread Handles}



\subsubsubsection{\hcode{ompd_get_thread_in_parallel}}
\label{subsubsubsec:ompd_get_thread_in_parallel}

\summary
The  \code{ompd_get_thread_in_parallel} function enables a tool to obtain 
handles for OpenMP threads that are associated with a parallel region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_thread_in_parallel(
  ompd_parallel_handle_t *\plc{parallel_handle},
  int \plc{thread_num},
  ompd_thread_handle_t **\plc{thread_handle}
);
\end{ompSyntax}
\end{cspecific}


\descr
A successful invocation of  \code{ompd_get_thread_in_parallel} returns a 
pointer to a thread handle in the location to which \code{thread_handle}
points. This call yields  meaningful results only if all OpenMP threads 
in the parallel region are stopped.

\argdesc
The \plc{parallel_handle} argument is an opaque handle for a parallel region
and selects the parallel region on which to operate. The \plc{thread_num} 
argument selects the thread of the team to be returned. On return, the 
\plc{thread_handle} argument is an opaque handle for the selected thread.

\restrictions
The \code{ompd_get_thread_in_parallel} function has the following restriction:

\begin{itemize}
\item The value of \plc{thread_num} must be a non-negative integer smaller 
      than the team size that was provided as the \plc{ompd-team-size-var} 
      from \code{ompd_get_icv_from_scope}.
\end{itemize}

\crossreferences
\begin{itemize}
\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_get_icv_from_scope} call, 
see \specref{subsubsubsec:ompd_get_icv_from_scope}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_thread_handle}}
\label{subsubsubsec:ompd_get_thread_handle}

\summary
The \code{ompd_get_thread_handle} function maps a native thread 
to an OMPD thread handle.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_thread_handle(
  ompd_address_space_handle_t *\plc{handle},
  ompd_thread_id_t \plc{kind},
  ompd_size_t \plc{sizeof_thread_id},
  const void *\plc{thread_id},
  ompd_thread_handle_t **\plc{thread_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_thread_handle} function determines if a native thread 
that the native thread identifier to which  \plc{thread_id} points represents 
an OpenMP thread. If so, the function returns \code{ompd_rc_ok} and the 
location to which \plc{thread_handle} points is set to the thread handle 
for the OpenMP thread.

\argdesc
The \plc{handle} argument is an opaque handle that the tool provides
to reference an address space. The \plc{kind}, \plc{sizeof_thread_id}, 
and \plc{thread_id} arguments represent a native thread identifier.
On return, the \plc{thread_handle} argument provides an opaque handle 
to the thread within the provided address space.

The native thread identifier to which \plc{thread_id} points is guaranteed 
to be valid  for the duration of the call. If the OMPD library must retain 
the native thread identifier, it must copy it.

\crossreferences
\begin{itemize}
\item \code{ompd_size_t} type, see \specref{subsubsubsec:ompd_size_t}.

\item \code{ompd_thread_id_t} type, see \specref{ompd:ompd_thread_id_t}.

\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_rel_thread_handle}}
\label{subsubsubsec:ompd_rel_thread_handle}
\summary
The \code{ompd_rel_thread_handle} function releases a thread handle.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_rel_thread_handle(
  ompd_thread_handle_t *\plc{thread_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
Thread handles are opaque to tools, which therefore cannot release them 
directly. Instead, when the tool is finished with a thread handle it must 
pass it to \code{ompd_rel_thread_handle} for disposal.

\argdesc
The \plc{thread_handle} argument is an opaque handle for a thread to be released.

\crossreferences
\begin{itemize}
\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_thread_handle_compare}}
\label{subsubsubsec:ompd_thread_handle_compare}
\summary
The \code{ompd_thread_handle_compare} function allows tools to compare
two thread handles.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_thread_handle_compare(
  ompd_thread_handle_t *\plc{thread_handle_1},
  ompd_thread_handle_t *\plc{thread_handle_2},
  int *\plc{cmp_value}
);
\end{ompSyntax}
\end{cspecific}

\descr
The internal structure of thread handles is opaque to a tool. While the 
tool can easily compare pointers to thread handles, it cannot determine 
whether handles of two different addresses refer to the same underlying 
thread. The \code{ompd_thread_handle_compare} function compares thread handles.

On success, \code{ompd_thread_handle_compare} returns in the location to 
which \plc{cmp_value} points a signed integer value that indicates how the 
underlying threads compare: a value less than, equal to, or greater than 0 
indicates that the thread corresponding to \plc{thread_handle_1} is, respectively,
less than, equal to, or greater than that corresponding to \plc{thread_handle_2}.

\argdesc
The \plc{thread_handle_1} and \plc{thread_handle_2} arguments are opaque 
handles for threads. On return the \plc{cmp_value} argument is set to a 
signed integer value.

\crossreferences
\begin{itemize}
\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_thread_id}}
\label{subsubsubsec:ompd_get_thread_id}
\summary
The \code{ompd_get_thread_id} maps an OMPD thread handle to a native thread.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_thread_id(
  ompd_thread_handle_t *\plc{thread_handle},
  ompd_thread_id_t \plc{kind},
  ompd_size_t \plc{sizeof_thread_id},
  void *\plc{thread_id}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_thread_id} function maps an OMPD thread handle to a 
native thread identifier.

\argdesc
The \plc{thread_handle} argument is an opaque thread handle. The \plc{kind} 
argument represents the native thread identifier. The \plc{sizeof_thread_id}
argument represents the size of the native thread identifier. On return, the 
\plc{thread_id} argument is a buffer that represents a native thread identifier.

\crossreferences
\begin{itemize}
\item \code{ompd_size_t} type, see \specref{subsubsubsec:ompd_size_t}.

\item \code{ompd_thread_id_t} type, see \specref{ompd:ompd_thread_id_t}.

\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsection{Parallel Region Handles}

\subsubsubsection{\hcode{ompd_get_curr_parallel_handle}}
\label{subsubsubsec:ompd_get_curr_parallel_handle}
\summary
The  \code{ompd_get_curr_parallel_handle} function obtains a pointer 
to the parallel handle for an OpenMP thread's current parallel region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_curr_parallel_handle(
  ompd_thread_handle_t *\plc{thread_handle},
  ompd_parallel_handle_t **\plc{parallel_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The  \code{ompd_get_curr_parallel_handle} function enables the tool 
to obtain a pointer to the parallel handle for the current parallel region 
that is associated with an OpenMP thread. This call is meaningful only if 
the associated thread is stopped. The parallel handle must be released by 
calling \code{ompd_rel_parallel_handle}.

\argdesc
The \plc{thread_handle} argument is an opaque handle for a thread and selects 
the thread on which to operate. On return, the \plc{parallel_handle} 
argument is set to a handle for the parallel region that the associated thread 
is currently executing, if any.

\crossreferences
\begin{itemize}
\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_parallel_handle} call, 
see \specref{subsubsubsec:ompd_rel_parallel_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_enclosing_parallel_handle}}
\label{subsubsubsec:ompd_get_enclosing_parallel_handle}

\summary
The  \code{ompd_get_enclosing_parallel_handle} function obtains a pointer 
to the parallel handle for an enclosing parallel region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_enclosing_parallel_handle(
  ompd_parallel_handle_t *\plc{parallel_handle},
  ompd_parallel_handle_t **\plc{enclosing_parallel_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The  \code{ompd_get_enclosing_parallel_handle} function enables a tool 
to obtain a pointer to the parallel handle for the parallel region that
encloses the parallel region that \code{parallel_handle} specifies. This 
call is meaningful only if at least one thread in the parallel region 
is stopped. A pointer to the parallel handle for the enclosing region 
is returned in the location to which \plc{enclosing_parallel_handle}
points. After the call, the tool owns the handle; the tool must release the 
handle with \code{ompd_rel_parallel_handle} when it is no longer required.

\argdesc
The \plc{parallel_handle} argument is an opaque handle for a parallel 
region that selects the parallel region on which to operate. On return, 
the \plc{enclosing_parallel_handle} argument is set to a handle for the 
parallel region that encloses the selected parallel region.

\crossreferences
\begin{itemize}
\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_parallel_handle} call, 
see \specref{subsubsubsec:ompd_rel_parallel_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_task_parallel_handle}}
\label{subsubsubsec:ompd_get_task_parallel_handle}
\summary
The  \code{ompd_get_task_parallel_handle} function obtains a pointer to 
the parallel handle for the parallel region that encloses a task region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_task_parallel_handle(
  ompd_task_handle_t *\plc{task_handle},
  ompd_parallel_handle_t **\plc{task_parallel_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The  \code{ompd_get_task_parallel_handle} function enables a tool to obtain a
pointer to the parallel handle for the parallel region that encloses the task 
region that \plc{task_handle} specifies. This call is meaningful only if at 
least one thread in the parallel region is stopped. A pointer to the parallel 
regions handle is returned in the location to which \plc{task_parallel_handle}
points. The tool owns that parallel handle, which it must release with 
\code{ompd_rel_parallel_handle}.

\argdesc
The \plc{task_handle} argument is an opaque handle that selects the task on 
which to operate. On return, the \plc{parallel_handle} argument is set 
to a handle for the parallel region that encloses the selected task.

\crossreferences
\begin{itemize}
\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_parallel_handle} call, 
see \specref{subsubsubsec:ompd_rel_parallel_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_rel_parallel_handle}}
\label{subsubsubsec:ompd_rel_parallel_handle}
\summary
The \code{ompd_rel_parallel_handle} function releases a parallel region handle.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_rel_parallel_handle(
  ompd_parallel_handle_t *\plc{parallel_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
Parallel region handles are opaque so tools cannot release them directly. 
Instead, a tool must pass a parallel region handle to the 
\code{ompd_rel_parallel_handle} function for disposal when finished with it.

\argdesc
The \plc{parallel_handle} argument is an opaque handle to be released.

\crossreferences
\begin{itemize}
\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_parallel_handle_compare}}
\label{subsubsubsec:ompd_parallel_handle_compare}

\summary
The \code{ompd_parallel_handle_compare} function compares two parallel 
region handles.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_parallel_handle_compare(
  ompd_parallel_handle_t *\plc{parallel_handle_1},
  ompd_parallel_handle_t *\plc{parallel_handle_2},
  int *\plc{cmp_value}
);
\end{ompSyntax}
\end{cspecific}

\descr
The internal structure of parallel region handles is opaque to tools. While 
tools can easily compare pointers to parallel region handles, they cannot 
determine whether handles at two different addresses refer to the same 
underlying parallel region and, instead must use the 
\code{ompd_parallel_handle_compare} function.

On success, \code{ompd_parallel_handle_compare} returns a signed integer value 
in the location to which \plc{cmp_value} points that indicates how the underlying 
parallel regions compare. A value less than, equal to, or greater than 0 indicates
that the region corresponding to \plc{parallel_handle_1} is, respectively, less 
than, equal to, or greater than that corresponding to \plc{parallel_handle_2}.
This function is provided since the means by which parallel region handles are 
ordered is implementation defined.

\argdesc
The \plc{parallel_handle_1} and \plc{parallel_handle_2} arguments are 
opaque handles that correspond to parallel regions. On return the \plc{cmp_value}
argument points to a signed integer value that indicates how the underlying 
parallel regions compare.

\crossreferences
\begin{itemize}
\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsection{Task Handles}



\subsubsubsection{\hcode{ompd_get_curr_task_handle}}
\label{subsubsubsec:ompd_get_curr_task_handle}

\summary
The \code{ompd_get_curr_task_handle} function obtains a pointer to the task 
handle for the current task region that is associated with an OpenMP thread.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_curr_task_handle(
  ompd_thread_handle_t *\plc{thread_handle},
  ompd_task_handle_t **\plc{task_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_curr_task_handle} function obtains a pointer to the task 
handle for the current task region that is associated with an OpenMP thread.
This call is meaningful only if the thread for which the handle is provided 
is stopped. The task handle must be released with \code{ompd_rel_task_handle}.

\argdesc
The \plc{thread_handle} argument is an opaque handle that selects the thread 
on which to operate. On return, the \plc{task_handle} argument points to a 
location that points to a handle for the task that the thread is currently 
executing.

\crossreferences
\begin{itemize}
\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_task_handle} call, 
see \specref{subsubsubsec:ompd_rel_task_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_generating_task_handle}}
\label{subsubsubsec:ompd_get_generating_task_handle}

\summary
The \code{ompd_get_generating_task_handle} function obtains a pointer 
to the task handle of a generating task region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_generating_task_handle(
  ompd_task_handle_t *\plc{task_handle},
  ompd_task_handle_t **\plc{generating_task_handle}
);
\end{ompSyntax}
\end{cspecific}


\descr
The \code{ompd_get_generating_task_handle} function obtains a pointer to 
the task handle for the task that encountered the OpenMP task construct 
that generated the task represented by \plc{task_handle}. The generating 
task is the OpenMP task that was active when the task specified by 
\plc{task_handle} was created. This call is meaningful only if the thread 
that is executing the task that \plc{task_handle} specifies is stopped. 
The generating task handle must be released with \code{ompd_rel_task_handle}.

\argdesc
The \plc{task_handle} argument is an opaque handle that selects the task on
which to operate. On return, the \plc{generating_task_handle} argument points
to a location that points to a handle for the generating task.

\crossreferences
\begin{itemize}
\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_task_handle} call, 
see \specref{subsubsubsec:ompd_rel_task_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_scheduling_task_handle}}
\label{subsubsubsec:ompd_get_scheduling_task_handle}
\summary
The \code{ompd_get_scheduling_task_handle} function obtains a task handle 
for the task that was active at a task scheduling point.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_scheduling_task_handle(
  ompd_task_handle_t *\plc{task_handle},
  ompd_task_handle_t **\plc{scheduling_task_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_scheduling_task_handle} function obtains a task handle 
for the task that was active when the task that \plc{task_handle} represents
was scheduled. This call is meaningful only if the thread that is executing 
the task that \plc{task_handle} specifies is stopped. The scheduling task 
handle must be released with \code{ompd_rel_task_handle}.

\argdesc
The \plc{task_handle} argument is an opaque handle for a task and selects 
the task on which to operate. On return, the \plc{scheduling_task_handle} 
argument points to a location that points to a handle for the task that is
still on the stack of execution on the same thread and was deferred in favor 
of executing the selected task.

\crossreferences
\begin{itemize}
\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_rel_task_handle} call, see 
\specref{subsubsubsec:ompd_rel_task_handle}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_task_in_parallel}}
\label{subsubsubsec:ompd_get_task_in_parallel}
\summary
The  \code{ompd_get_task_in_parallel} function obtains handles for
the implicit tasks that are associated with a parallel region.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_task_in_parallel(
  ompd_parallel_handle_t *\plc{parallel_handle},
  int \plc{thread_num},
  ompd_task_handle_t **\plc{task_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_task_in_parallel} function obtains handles for
the implicit tasks that are associated with a parallel region. A 
successful invocation of  \code{ompd_get_task_in_parallel} returns 
a pointer to a task handle in the location to which \plc{task_handle}
points. This call yields meaningful results only if all OpenMP threads 
in the parallel region are stopped.

\argdesc
The \plc{parallel_handle} argument is an opaque handle that selects the 
parallel region on which to operate. The \plc{thread_num} argument selects 
the implicit task of the team that is returned. The selected implicit task 
would return \plc{thread_num} from a call of the \code{omp_get_thread_num()} 
routine. On return, the \plc{task_handle} argument points to a location 
that points to an opaque handle for the selected implicit task.

\restrictions

The following restriction applies to the \code{ompd_get_task_in_parallel} function:

\begin{itemize}
\item The value of \plc{thread_num} must be a non-negative integer that is 
      smaller than the size of the team size that is the value of the 
      \plc{ompd-team-size-var} that \code{ompd_get_icv_from_scope} returns.
\end{itemize}

\crossreferences
\begin{itemize}
\item \code{ompd_parallel_handle_t} type, 
see \specref{subsubsec:ompd_parallel_handle_t}.

\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_get_icv_from_scope} call, 
see \specref{subsubsubsec:ompd_get_icv_from_scope}.
\end{itemize}



\subsubsubsection{\hcode{ompd_rel_task_handle}}
\label{subsubsubsec:ompd_rel_task_handle}
\summary
This \code{ompd_rel_task_handle} function releases a task handle.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_rel_task_handle(
  ompd_task_handle_t *\plc{task_handle}
);
\end{ompSyntax}
\end{cspecific}

\descr
Task handles are opaque so tools cannot release them directly. Instead, 
when a tool is finished with a task handle it must use the 
\code{ompd_rel_task_handle} function to release it.

\argdesc
The \plc{task_handle} argument is an opaque task handle to be released.

\crossreferences
\begin{itemize}
\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_task_handle_compare}}
\label{subsubsubsec:ompd_task_handle_compare}
\summary
The \code{ompd_task_handle_compare} function compares task handles.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_task_handle_compare(
  ompd_task_handle_t *\plc{task_handle_1},
  ompd_task_handle_t *\plc{task_handle_2},
  int *\plc{cmp_value}
);
\end{ompSyntax}
\end{cspecific}


\descr
The internal structure of task handles is opaque so tools  cannot directly
determine if handles at two different addresses refer to the same underlying 
task. The \code{ompd_task_handle_compare} function compares task handles.
After a successful call to \code{ompd_task_handle_compare}, the value of 
the location to which \plc{cmp_value} points is a signed integer that 
indicates how the underlying tasks compare: a value less than, equal to, 
or greater than 0 indicates that the task that corresponds to \plc{task_handle_1} 
is, respectively, less than, equal to, or greater than the task that 
corresponds to \plc{task_handle_2}. The means by which task handles are 
ordered is implementation defined.

\argdesc
The \plc{task_handle_1} and \plc{task_handle_2} arguments are opaque handles
that correspond to tasks. On return, the \plc{cmp_value} argument points to
a location in which a signed integer value indicates how the underlying tasks 
compare.

\crossreferences
\begin{itemize}
\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_task_function}}
\label{subsubsubsec:ompd_get_task_function}

\summary
This \code{ompd_get_task_function} function returns the entry point of 
the code that corresponds to the body of a task.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_task_function (
  ompd_task_handle_t *\plc{task_handle},
  ompd_address_t *\plc{entry_point}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_task_function} function returns the entry point of the code
that corresponds to the body of code that the task executes.

\argdesc
The \plc{task_handle} argument is an opaque handle that selects the task 
on which to operate. On return, the \plc{entry_point} argument is set to
an address that describes the beginning of application code that executes 
the task region.

\crossreferences
\begin{itemize}
\item \code{ompd_address_t} type, see \specref{subsubsubsec:ompd_address_t}.

\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_task_frame}}
\label{subsubsubsec:ompd_get_task_frame}
\summary
The \code{ompd_get_task_frame} function extracts the frame pointers of a task.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_task_frame (
  ompd_task_handle_t *\plc{task_handle},
  ompd_frame_info_t *\plc{exit_frame},
  ompd_frame_info_t *\plc{enter_frame}
);
\end{ompSyntax}
\end{cspecific}

\descr
An OpenMP implementation  maintains an \code{ompt_frame_t} object for every 
implicit or explicit task. The \code{ompd_get_task_frame} function extracts 
the \plc{enter_frame} and \plc{exit_frame} fields of the \code{ompt_frame_t} 
object of the task that \plc{task_handle} identifies.

\argdesc
The \plc{task_handle} argument specifies an OpenMP task. On return, the 
\plc{exit_frame} argument points to an \code{ompd_frame_info_t} object  
that has the frame information with the same semantics as the \plc{exit_frame} 
field in the \code{ompt_frame_t} object that is associated with the specified 
task. On return, the \plc{enter_frame} argument points to an 
\code{ompd_frame_info_t} object that has the frame information with the same 
semantics as the \plc{enter_frame} field in the \code{ompt_frame_t} object 
that is associated with the specified task. The \plc{frame_flags} argument 
is a conjunction of enum items in \code{ompt_frame_flag_t}. This argument 
specifies the meaning of the \plc{exit_frame} and \plc{enter_frame} argument.

\crossreferences
\begin{itemize}
\item \code{ompd_address_t} type, see \specref{subsubsubsec:ompd_address_t}.

\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompt_frame_t} type, see \specref{sec:ompt_frame_t}.

\item \code{ompd_frame_info_t} type, see \specref{subsubsubsec:ompd_frame_info_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_enumerate_states}}
\label{subsubsubsec:ompd_enumerate_states}

\summary
The \code{ompd_enumerate_states} function enumerates thread states 
that an OpenMP implementation supports.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_enumerate_states (
  ompd_address_space_handle_t *\plc{address_space_handle},
  ompd_word_t \plc{current_state},
  ompd_word_t *\plc{next_state},
  const char **\plc{next_state_name},
  ompd_word_t *\plc{more_enums}
);
\end{ompSyntax}
\end{cspecific}

\descr
An OpenMP implementation may support only a subset of the states that 
the \code{omp_states_t} enumeration type defines. In addition, an
OpenMP implementation may support implementation-specific states.
The \code{ompd_enumerate_states} call enables a tool to enumerate 
the thread states that an OpenMP implementation supports.

When the \plc{current_state} argument is a thread state that an OpenMP 
implementation supports, the call assigns the value and string name of 
the next thread state in the enumeration to the locations to which the 
\plc{next_state} and \plc{next_state_name} arguments point.

On return, the third-party tool owns the \plc{next_state_name} string.
The OMPD library allocates storage for the string with the memory allocation 
callback that the tool provides. The tool is responsible for releasing the memory.

On return, the location to which the \plc{more_enums} argument points has
the value $1$ whenever one or more states are left in the enumeration. On
return, the location to which the \plc{more_enums} argument points
has the value $0$ when \plc{current_state} is the last state in the enumeration.

\argdesc
The \plc{address_space_handle} argument identifies the address space. 
The \plc{current_state} argument must be a thread state that the OpenMP 
implementation supports. To begin enumerating the supported states, a 
tool should pass \code{ompt_state_undefined} as the value of \plc{current_state}.
Subsequent calls to \code{ompd_enumerate_states} by the tool should pass the
value that the call returned in the \plc{next_state} argument. On return, the 
\plc{next_state} argument points to an integer with the value of the next state 
in the enumeration. On return, the \plc{next_state_name} argument points to a 
character string that describes the next state. On return, the \plc{more_enums} 
argument points to an integer with a value of $1$ when more states are left to 
enumerate and a value of $0$ when no more states are left.

\constraints
Any string that is returned through the \plc{next_state_name} argument 
must be immutable and defined for the lifetime of program execution.

\crossreferences
\begin{itemize}
\item \code{ompd_address_space_handle_t} type, 
see \specref{subsubsec:ompd_address_space_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompt_state_t} type, see \specref{sec:thread-states}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_state}}
\label{subsubsubsec:ompd_get_state}
\summary
The \code{ompd_get_state} function obtains the state of a thread.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_state (
  ompd_thread_handle_t *\plc{thread_handle},
  ompd_word_t *\plc{state},
  ompt_wait_id_t *\plc{wait_id}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_state} function returns the state of an OpenMP thread.

\argdesc
The \plc{thread_handle} argument identifies the thread. The \plc{state} 
argument represents the state of that thread as represented by a value 
that \code{ompd_enumerate_states} returns. On return, the \plc{wait_id} 
argument points to a handle that corresponds to the \plc{wait_id} wait 
identifier of the thread if it is non-null. If the thread state is not 
one of the specified wait states, the value to which \plc{wait_id} 
points is undefined.

\crossreferences
\begin{itemize}
\item \code{ompd_wait_id_t} type, see \specref{subsubsubsec:ompd_wait_id_t}.

\item \code{ompd_thread_handle_t} type, 
see \specref{subsubsec:ompd_thread_handle_t}.

\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.

\item \code{ompd_enumerate_states} call, 
see \specref{subsubsubsec:ompd_enumerate_states}.
\end{itemize}



\subsubsection{Display Control Variables}



\subsubsubsection{\hcode{ompd_get_display_control_vars}}
\label{subsubsubsec:ompd_get_display_control_vars}

\summary
The \code{ompd_get_display_control_vars} function returns a list of 
name/value pairs for the OpenMP control variables that are user-controllable 
and important to the operation or performance of OpenMP programs.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_display_control_vars (
  ompd_address_space_handle_t *\plc{address_space_handle},
  const char * const **\plc{control_vars}
);
\end{ompSyntax}
\end{cspecific}

\descr
The \code{ompd_get_display_control_vars} function returns a
NULL-terminated vector of strings of name/value pairs of control
variables that have user controllable settings and are important 
to the operation or performance of an OpenMP runtime system. The 
control variables that this interface exposes include all OpenMP 
environment variables, settings that may come from vendor or 
platform-specific environment variables, and other settings that 
affect the operation or functioning of an OpenMP runtime.

The format of the strings is:
\begin{center}
\code{name=a string}
\end{center}

The third-party tool must not modify the vector or the strings.
The strings are NULL terminated.
The vector is NULL terminated.

After returning from the call, the vector and strings are `owned'
by the third-party tool.
Providing the termination constraints are satisfied, the OMPD library
is free to use static or dynamic memory for the
vector and/or the strings, and to arrange them in memory
as it pleases.
If dynamic memory is used, then the OMPD library must use
the allocate callback it received in the call to \code{ompd_initialize}.
As the third-party tool cannot make any assumptions about the origin or
layout of the memory used for the vector or strings, it cannot release
the display control variables directly when they are no longer
needed; instead it must use \code{ompd_rel_display_control_vars()}.

\argdesc
The address space is identified by the input argument \plc{address_space_handle}.
The vector of display control variables is returned through
the output argument \plc{control_vars}.

\crossreferences
\begin{itemize}
	\item \code{ompd_address_space_handle_t} type, see 
	\specref{subsubsec:ompd_address_space_handle_t}.
	\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
	\item \code{ompd_initialize} call, see \specref{subsubsubsec:ompd_initialize}.
	\item \code{ompd_rel_display_control_vars} type, see 
	\specref{subsubsubsec:ompd_rel_display_control_vars}.
\end{itemize}


\subsubsubsection{\hcode{ompd_rel_display_control_vars}}
\label{subsubsubsec:ompd_rel_display_control_vars}
\summary

Releases a list of name/value pairs of OpenMP control variables
previously acquired using \code{ompd_get_display_control_vars}.
\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_rel_display_control_vars (
  const char * const **\plc{control_vars}
);
\end{ompSyntax}
\end{cspecific}

\descr
The vector and strings returned from \code{ompd_get_display_control_vars}
are `owned' by the third-party tool, but allocated by the OMPD library.
Because the third-party tool doesn't know how the memory for the vector
and strings was allocated, it cannot deallocate the memory itself.
Instead, the third-party tool must call
\code{ompd_rel_display_control_vars} to release the vector
and strings.

\argdesc
The input parameter \plc{control_vars} is the vector of display control variables to be released.

\crossreferences
\begin{itemize}
  \item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
	\item \code{ompd_get_display_control_vars} call, see \specref{subsubsubsec:ompd_get_display_control_vars}.
\end{itemize}


\subsubsection{Accessing Scope Specific Information}

\subsubsubsection{\hcode{ompd_enumerate_icvs}}
\label{subsubsubsec:ompd_enumerate_icvs}

\summary
Enumerate ICVs supported by an OpenMP implementation.

\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_enumerate_icvs (
  ompd_address_space_handle *\plc{handle}, 
  ompd_icv_id_t \plc{current},
  ompd_icv_id_t *\plc{next_id},
  const char **\plc{next_icv_name},
  ompd_scope_t *\plc{next_scope},
  int *\plc{more}
);
\end{ompSyntax}
\end{cspecific}

\descr
In addition to the ICVs listed in Table~\ref{tab:ICV Initial Values}, an OpenMP 
implementation must support the OMPD specific ICVs listed in Table~\ref{tab:OMPD internal varibales} in 
the OMPD interface.
An OpenMP implementation might support additional implementation specific variables.

Also an implementation might decide to store ICVs in a different scope than suggested in 
Table~\ref{tab:Scopes of ICVs}.
The \code{ompd_enumerate_icvs} call enables a tool to enumerate the ICVs supported by an 
OpenMP implementation and the related scopes.

When the \plc{current} input argument is set to a value supported by an OpenMP 
implementation,
the call will assign the value, string name, and scope of the next ICV in the enumeration
to the locations pointed to by the 
\plc{next_id}, \plc{next_icv_name}, and \plc{next_scope} output arguments, respectively.

After returning from the call, the string \plc{next_icv_name} is `owned' by the 
third-party tool.
The string storage must be allocated by the OMPD library using the memory allocation 
callback provided by the tool.
The tool is responsible for releasing the memory.


Whenever one or more ICV are left in the enumeration,
the call will set the location pointed to by the \plc{more} 
output argument to $1$.
When the last ICV in the enumeration is passed in \plc{current}, 
the call will set the location pointed to by the \plc{more} output
argument to $0$


\argdesc

The address space is identified by the input argument \plc{address_space_handle}.

The input argument \plc{current} must be an ICV supported by the OpenMP implementation.  
To begin enumerating the ICVs that an OpenMP implementation supports, a tool should pass
\code{ompd_icv_undefined} as the value of the input argument \plc{current}.  
Subsequent calls to \code{ompd_enumerate_icvs} by the tool should pass the
value returned by the call in the \plc{next_id} output argument.

The output argument \plc{next_id} is a pointer to an integer where
the call will return the id of the next ICV in the
enumeration.

The output argument \plc{next_icv} is a pointer to a
character string pointer, where the call will return a string
providing the name of the next ICV.

The output argument \plc{next_scope} is a pointer to a
scope enum value, where the call will return the scope for the next ICV.

The output argument \plc{more_enums} is a pointer to an integer where
the call will return a value of $1$ when there are more ICV left to enumerate
or a value of $0$ when there are not.

\constraints
Any string returned through the argument
\plc{next_icv} must be immutable and defined
for the lifetime of a program execution.

\begin{table}[h!]
\caption{OMPD-specific ICVs\label{tab:OMPD internal varibales}}
\begin{tabular}{p{1.5in} p{0.5in} p{2.7in}}
\hline
\textsf{\textbf{Variable}} & \textsf{\textbf{Scope}} & \textsf{\textbf{Meaning}}\\
\hline
{\splc{ompd-num-procs-var}} & device & return value of \scode{omp_get_num_procs()} when 
executed on this device \\
{\splc{ompd-thread-num-var}} & task & return value of \scode{omp_get_thread_num()} when 
executed in this task \\
{\splc{ompd-final-var}} & task &  return value of \scode{omp_in_final()} when 
executed in this task \\
{\splc{ompd-implicit-var}} & task & the task is an implicit task\\
{\splc{ompd-team-size-var}} & team & return value of \scode{omp_get_num_threads()} 
when executed in this team \\
\hline
\end{tabular}
\end{table}


\crossreferences
\begin{itemize}
	\item \code{ompd_address_space_handle_t} type, see 
	\specref{subsubsec:ompd_address_space_handle_t}.
	\item \code{ompd_scope_t} type, see \specref{subsubsec:ompd_scope_t}.
	\item \code{ompd_icv_id_t} type, see \specref{subsubsec:ompd_icv_id_t}.
	\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}



\subsubsubsection{\hcode{ompd_get_icv_from_scope}}
\label{subsubsubsec:ompd_get_icv_from_scope}
\summary
Returns the value of an ICV as present in the provided scope.
\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_icv_from_scope (
  void *\plc{handle}, 
  ompd_scope_t \plc{scope},
  ompd_icv_id_t \plc{icv_id},
  ompd_word_t *\plc{icv_value}
); 
\end{ompSyntax}
\end{cspecific}

\descr
The function \code{ompd_get_icv_from_scope} provides access to the internal control 
variables as defined in Tables~\ref{tab:ICV Initial Values} and~\ref{tab:OMPD internal varibales}.

\argdesc

The argument \plc{handle} provides an OpenMP scope handle.
The argument \plc{scope} specifies the kind of scope provided in \plc{handle}.
The argument \plc{icv_name} specifies the name of the requested ICV.
On success, the output argument \plc{icv_value} is set to the value of the 
requested ICV.

\constraints

If the ICV cannot be represented by an integer type value, the function returns 
\code{ompd_rc_incompatible}. 

The provided \plc{handle} must match the \plc{scope} as defined in 
\specref{subsubsec:ompd_icv_id_t}. 

The provided \plc{scope} must match the scope for \plc{icv_id} as requested by 
\code{ompd_enumerate_icvs}. 

\crossreferences
\begin{itemize}
	\item \code{ompd_address_space_handle_t} type, see 
	   \specref{subsubsec:ompd_address_space_handle_t}.
	\item \code{ompd_thread_handle_t} type, see \specref{subsubsec:ompd_thread_handle_t}.
	\item \code{ompd_parallel_handle_t} type, see 
       \specref{subsubsec:ompd_parallel_handle_t}.
	\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.
	\item \code{ompd_scope_t} type, see \specref{subsubsec:ompd_scope_t}.
	\item \code{ompd_icv_id_t} type, see \specref{subsubsec:ompd_icv_id_t}.
	\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}

\subsubsubsection{\hcode{ompd_get_icv_string_from_scope}}
\label{subsubsubsec:ompd_get_icv_string_from_scope}
\summary
Returns the value of an ICV as present in the provided scope.
\format
\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_icv_string_from_scope (
  void *\plc{handle},
  ompd_scope_t \plc{scope},
  ompd_icv_id_t \plc{icv_id},
  const char **\plc{icv_string}
); 
\end{ompSyntax}
\end{cspecific}

\descr
The function \code{ompd_get_icv_string_from_scope} provides access to the internal 
control variables as defined in Table~\ref{tab:ICV Initial Values}.

\argdesc

The argument \plc{handle} provides an OpenMP scope handle.
The argument \plc{scope} specifies the kind of scope provided in \plc{handle}.
The argument \plc{icv_id} specifies the id of the requested ICV.
On successful return, the output argument \plc{icv_string} points to a string 
representation of the requested ICV.

After returning from the call, the string \plc{icv_string} is `owned' by the third-party 
tool.
The string storage must be allocated by the OMPD library using the memory allocation 
callback provided by the tool.
The tool is responsible for releasing the memory.


\constraints
Any string passed through the argument \plc{icv_string} must be allocated by the OMPD 
library with the memory alloc callback \code{ompd_callback_memory_alloc_fn_t} and freed 
by the tool.

The provided \plc{handle} must match the \plc{scope} as defined in 
\specref{subsubsec:ompd_icv_id_t}. 

The provided \plc{scope} must match the scope for \plc{icv_id} as requested by 
\code{ompd_enumerate_icvs}. 


\crossreferences
\begin{itemize}
	\item \code{ompd_address_space_handle_t} type, see 
	\specref{subsubsec:ompd_address_space_handle_t}.
	\item \code{ompd_thread_handle_t} type, see \specref{subsubsec:ompd_thread_handle_t}.
	\item \code{ompd_parallel_handle_t} type, see 
	\specref{subsubsec:ompd_parallel_handle_t}.
	\item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.
	\item \code{ompd_scope_t} type, see \specref{subsubsec:ompd_scope_t}.
	\item \code{ompd_icv_id_t} type, see \specref{subsubsec:ompd_icv_id_t}.
	\item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}

\subsubsubsection{\hcode{ompd_get_tool_data}}
\label{subsubsubsec:ompd_get_tool_data}
\summary
The \code{ompd_get_tool_data} function provides access to the OMPT data variable 
stored for each OpenMP scope.

\format

\begin{cspecific}
\begin{ompSyntax}
ompd_rc_t ompd_get_tool_data(
  void* \plc{handle}, 
  ompd_scope_t \plc{scope},
  ompd_word_t *\plc{value},
  ompd_address_t *\plc{ptr}
);
\end{ompSyntax}
\end{cspecific}

\descr
The function \code{ompd_get_tool_data} provides access to the OMPT tool data
stored for each scope.

If the runtime library has no support for OMPT, the function returns 
\code{ompd_rc_unsupported}.


\argdesc
The argument \plc{handle} provides an OpenMP scope handle.
The argument \plc{scope} specifies the kind of scope provided in \plc{handle}.
On return, the output argument \plc{value} is set to the \plc{value} field of the 
\code{ompt_data_t} union stored for the selected scope.
On return, the output argument \plc{ptr} is set to the  \plc{ptr} field of the 
\code{ompt_data_t} union stored for the selected scope.


\crossreferences
\begin{itemize}
    \item \code{ompt_data_t} type, see \specref{sec:ompt_data_t}.
	\item \code{ompd_address_space_handle_t} type, see 
        \specref{subsubsec:ompd_address_space_handle_t}.
    \item \code{ompd_thread_handle_t} type, see \specref{subsubsec:ompd_thread_handle_t}.
    \item \code{ompd_parallel_handle_t} type, see 
        \specref{subsubsec:ompd_parallel_handle_t}.
    \item \code{ompd_task_handle_t} type, see \specref{subsubsec:ompd_task_handle_t}.
    \item \code{ompd_scope_t} type, see \specref{subsubsec:ompd_scope_t}.
    \item \code{ompd_rc_t} type, see \specref{subsubsec:ompd_rc_t}.
\end{itemize}

